<div class="object" id="radio" onclick="revealInteraction('radio')"></div>
<div class="interaction" id="radio_interaction">
    <img src="objects/radio/radio.png" alt="radio" class="interaction-image">
    <div class="options" id="radio_options">
        <button id="batteryRadio" onclick="openradio()">Allumer</button>
        <button id="onRadio" onclick="turnOn()">Allumer</button>
        <button id="changeRadio" onclick="change()">Changer de fréquence</button>
        <button id="offRadio" onclick="turnOff()">Éteindre</button>
        <button onclick="closeInteraction('radio_interaction');">Fermer</button>
    </div>
    <div class="text"> 
        <p class="typewriter">Une vieille radio, elle a clairement survécu à la guerre de l'eau</p>
    </div>
</div>

<style>
    #radio {
        background: url(objects/radio/radio.png) center/contain no-repeat;

        /* Create a mask using the PNG's alpha */
        -webkit-mask: url(objects/radio/radio.png) center/contain no-repeat;
        mask: url(objects/radio/radio.png) center/contain no-repeat;
        
        width: 7%;
        height: 12%;
        top: 74%;
        left: 67%;
    }
    #onRadio, #offRadio, #changeRadio {
        display: none;
    }
</style>

<script>
    var hasBattery = false;
    var radioOn = false;
    var stationId = 0;

    function openradio(){
        if (GameSave.hasItem('battery')){
            const interactionBox = document.getElementById('radio_interaction');
            interactionBox.querySelector('.text p').innerText = "La batterie est insérée dans le poste. Des grésillements... puis une musique se lance";
            hasBattery = true;
            GameSave.removeItem('battery');
            document.getElementById('batteryRadio').style.display = 'none'; 
            document.getElementById('changeRadio').style.display = 'block';
            document.getElementById('offRadio').style.display = 'block';
            callTypeWriter("radio");
            AudioManager.playSfx('../../assets/audio/sfx/BrancheLaRadio.mp3');
            AudioManager.crossFade('../../assets/audio/music/3 pistes-Radio/InfoXylophe.mp3', 500, true);
            radioOn = true;
            return;
        }
        else{
            const interactionBox = document.getElementById('radio_interaction');
            interactionBox.querySelector('.text p').innerText = "Génial, elle n'a plus de batterie";
            callTypeWriter("radio");
            return;
        }
    }
    function change(){
        if (hasBattery && radioOn){
            const interactionBox = document.getElementById('radio_interaction');
            interactionBox.querySelector('.text p').innerText = "Vous changez de fréquence.";
            AudioManager.playSfx('../../assets/audio/sfx/ChangementDeChaineRadio.mp3');
            const stations = [
                '../../assets/audio/music/3 pistes-Radio/InfoXylophe.mp3',
                '../../assets/audio/music/3 pistes-Radio/Baila Mujer-radio2.mp3',
                '../../assets/audio/music/3 pistes-Radio/BabylonMusiqueRadio.mp3'
            ];
            
            let nextStationIndex = stationId + 1;
            if (nextStationIndex >= stations.length) {
                nextStationIndex = 0;
            }
            AudioManager.crossFade(stations[nextStationIndex], 500, true);
            stationId = nextStationIndex;
            callTypeWriter("radio");
            return;
        }
    }

    function turnOn(){
        if (hasBattery && !radioOn){
            const interactionBox = document.getElementById('radio_interaction');
            radioOn = true;
            document.getElementById('onRadio').style.display = 'none'; 
            document.getElementById('changeRadio').style.display = 'block';
            document.getElementById('offRadio').style.display = 'block';
            change();
            callTypeWriter("radio");
            return;
        }
    }
    function turnOff(){
        if (hasBattery && radioOn){
            const interactionBox = document.getElementById('radio_interaction');
            interactionBox.querySelector('.text p').innerText = "Le poste radio s'éteint dans un claquement sec";
            radioOn = false;
            AudioManager.crossFade('../../assets/audio/music/Musique5mins.mp3', 500, true);
            AudioManager.playSfx('../../assets/audio/sfx/ChangementDeChaineRadio.mp3');

            document.getElementById('onRadio').style.display = 'block'; 
            document.getElementById('changeRadio').style.display = 'none';
            document.getElementById('offRadio').style.display = 'none';

            callTypeWriter("radio");
            return;
        }
    }
</script>