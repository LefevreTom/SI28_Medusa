<div class="object" id="lever" onclick="revealInteraction('lever')"></div>

<div class="interaction" id="lever_interaction">
    <div class="lever-grid">
        <div class="lever" data-index="0" onclick="toggleLever(this)"></div>
        <div class="lever" data-index="1" onclick="toggleLever(this)"></div>
        <div class="lever" data-index="2" onclick="toggleLever(this)"></div>
        <div class="lever" data-index="3" onclick="toggleLever(this)"></div>
        <div class="lever" data-index="4" onclick="toggleLever(this)"></div>
        <div class="lever" data-index="5" onclick="toggleLever(this)"></div>
    </div>

    <div class="options" id="lever_options">
        <button onclick="confirmLeverCode()">Confirmer</button>
        <button onclick="closeInteraction('lever_interaction')">Fermer</button>
    </div>

    <div class="text">
        <p class="typewriter">Six leviers sont devant vous.</p>
    </div>
</div>

<style>
#lever {
    background-image: url(objects/lever/lever.png);

    -webkit-mask: url(objects/lever/lever.png) center/contain no-repeat;
    mask: url(objects/lever/lever.png) center/contain no-repeat;

    width: 8%;
    height: 16%;
    top: 36%;
    left: 23.4%;
}

/* Interaction levers */
.lever-grid {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: grid;
    grid-template-columns: repeat(3, 30%);
    grid-template-rows: repeat(2, 50%);
    gap: 10%;
    justify-content: center;
}

.lever {
    width: 130px;
    height: 140px;
    background-image: url(objects/lever/leverDown.png);
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    cursor: pointer;
}

.lever.on {
    background-image: url(objects/lever/leverUp.png);
}
</style>

<script>
    // 0 = off, 1 = on
    const leverPanelState = [0, 0, 0, 0, 0, 0];

    function toggleLever(el) {
        AudioManager.playSfx('../../assets/audio/sfx/Levier.mp3');
        const index = Number(el.dataset.index);

        leverPanelState[index] = leverPanelState[index] === 0 ? 1 : 0;
        el.classList.toggle('on');
    }

    function confirmLeverCode() {
        const enteredCode = leverPanelState.join('');
        const correctCode = '101011'; // change as needed

        if (enteredCode === correctCode) {
            const interactionBox = document.getElementById('lever_interaction');
            interactionBox.querySelector('.text p').innerText = "Click, click, click... Le m√©canisme s'enclenche.";
            callTypeWriter("lever");
            GameSave.addItem('key2');
            const optionsBox = document.getElementById('lever_options');
            optionsBox.innerHTML = `
                <button onclick="closeInteraction('lever_interaction');">Fermer</button>
            `;
        } else {
            const interactionBox = document.getElementById('lever_interaction');
            interactionBox.querySelector('.text p').innerText = "Rien ne se passe...";
            callTypeWriter("lever");
        }
    }
</script>
